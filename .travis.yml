language: minimal

sudo: required

services:
  - docker

env:
  - ADDON="ICantBelieveItsNotValetudo" HADOLINT="${HOME}/hadolint"
  - ADDON="MaryTTS" HADOLINT="${HOME}/hadolint"
  - ADDON="picoTTS" HADOLINT="${HOME}/hadolint"

install:
  - sudo apt-get install jq
  - chmod +x .scripts/build.sh
  - curl -L -o ${HADOLINT} "https://github.com/hadolint/hadolint/releases/download/v1.16.0/hadolint-$(uname -s)-$(uname -m)" && chmod 700 ${HADOLINT}

before_script:
  - violations=$(${HADOLINT} $ADDON/Dockerfile | tee /dev/stderr | wc -l)
  - if [ $violations -gt 4 ]; then exit 2; fi

script:
  - ./.scripts/build.sh $ADDON 
